# ğŸ” éƒ¨ç½²å¤±è´¥æ’æŸ¥æŒ‡å—

## ğŸ“Š å½“å‰çŠ¶æ€

ä»æˆªå›¾çœ‹ï¼ŒGitHub Actions æ„å»ºå¤±è´¥äº†ã€‚è®©æˆ‘ä»¬ä¸€æ­¥æ­¥æ’æŸ¥é—®é¢˜ã€‚

## ğŸ”‘ é¦–è¦æ£€æŸ¥ï¼šDEPLOY_KEY æ˜¯å¦é…ç½®

### é—®é¢˜ç—‡çŠ¶

å¦‚æœçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„é”™è¯¯ï¼š
```
Error: Action failed with "The key is not correctly formatted"
```

è¯´æ˜ **DEPLOY_KEY æ²¡æœ‰æ­£ç¡®é…ç½®**ã€‚

### è§£å†³æ–¹æ¡ˆ

#### æ­¥éª¤ 1: ç”Ÿæˆ SSH å¯†é’¥

åœ¨æœ¬åœ°è¿è¡Œï¼ˆåœ¨ mizuki ç›®å½•ä¸‹ï¼‰ï¼š

```bash
ssh-keygen -t rsa -b 4096 -C "deploy@mizuki" -f deploy-key -N ""
```

è¿™ä¼šç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ï¼š
- `deploy-key` - ç§é’¥
- `deploy-key.pub` - å…¬é’¥

#### æ­¥éª¤ 2: é…ç½®å…¬é’¥åˆ° Pages ä»“åº“

1. æ‰“å¼€æ–‡ä»¶ `deploy-key.pub`ï¼Œå¤åˆ¶å…¨éƒ¨å†…å®¹
2. è®¿é—®ï¼šhttps://github.com/dandingbobaishi/dandingbobaishi.github.io/settings/keys
3. ç‚¹å‡» **Add deploy key**
4. å¡«å†™ï¼š
   - Title: `MIZUKI_DEPLOY`
   - Key: ç²˜è´´å…¬é’¥å†…å®¹
   - âœ… **å¿…é¡»å‹¾é€‰** "Allow write access"
5. ç‚¹å‡» **Add key**

#### æ­¥éª¤ 3: é…ç½®ç§é’¥åˆ°æºç ä»“åº“

1. æ‰“å¼€æ–‡ä»¶ `deploy-key`ï¼ˆæ²¡æœ‰ .pub åç¼€ï¼‰ï¼Œå¤åˆ¶å…¨éƒ¨å†…å®¹
2. è®¿é—®ä½ çš„æºç ä»“åº“ Settings
3. è¿›å…¥ï¼š**Secrets and variables** â†’ **Actions**
4. ç‚¹å‡» **New repository secret**
5. å¡«å†™ï¼š
   - Name: `DEPLOY_KEY`ï¼ˆå¿…é¡»æ˜¯è¿™ä¸ªåå­—ï¼‰
   - Secret: ç²˜è´´ç§é’¥å†…å®¹
6. ç‚¹å‡» **Add secret**

#### æ­¥éª¤ 4: åˆ é™¤æœ¬åœ°å¯†é’¥æ–‡ä»¶

```bash
del deploy-key
del deploy-key.pub
```

---

## ğŸ”„ æ›¿ä»£æ–¹æ¡ˆï¼šä½¿ç”¨ GITHUB_TOKEN

å¦‚æœä½ ä¸æƒ³é…ç½® SSH å¯†é’¥ï¼Œå¯ä»¥ä½¿ç”¨æ›´ç®€å•çš„æ–¹æ³•ï¼š

### æ–¹æ¡ˆ A: éƒ¨ç½²åˆ°åŒä¸€ä»“åº“çš„ gh-pages åˆ†æ”¯

æˆ‘å·²ç»åˆ›å»ºäº† `deploy-fixed.yml`ï¼Œå®ƒä¼šï¼š
- ä½¿ç”¨ GitHub è‡ªåŠ¨æä¾›çš„ GITHUB_TOKEN
- éƒ¨ç½²åˆ°åŒä¸€ä»“åº“çš„ `gh-pages` åˆ†æ”¯
- ä¸éœ€è¦é…ç½® DEPLOY_KEY

**ä½¿ç”¨æ­¥éª¤**ï¼š

1. åˆ é™¤æˆ–é‡å‘½ååŸæ¥çš„ `deploy.yml`ï¼š
   ```bash
   cd .github/workflows
   ren deploy.yml deploy.yml.bak
   ```

2. æ¨é€ä»£ç ï¼Œä½¿ç”¨æ–°çš„ `deploy-fixed.yml`

3. åœ¨ GitHub ä»“åº“è®¾ç½®ä¸­ï¼š
   - Settings â†’ Pages
   - Source: Deploy from a branch
   - Branch: `gh-pages` / `root`
   - ä¿å­˜

4. è®¿é—®ï¼š`https://ä½ çš„ç”¨æˆ·å.github.io/ä½ çš„ä»“åº“å/`

### æ–¹æ¡ˆ B: æ‰‹åŠ¨éƒ¨ç½²

å¦‚æœè‡ªåŠ¨éƒ¨ç½²ä¸€ç›´æœ‰é—®é¢˜ï¼Œå¯ä»¥æ‰‹åŠ¨éƒ¨ç½²ï¼š

```bash
# 1. æ„å»º
cd mizuki
pnpm install
pnpm run build

# 2. è¿›å…¥æ„å»ºç›®å½•
cd dist

# 3. åˆå§‹åŒ– Git
git init
git add -A
git commit -m 'Deploy'

# 4. æ¨é€åˆ° Pages ä»“åº“
git push -f https://github.com/dandingbobaishi/dandingbobaishi.github.io.git master:main

# 5. è¿”å›
cd ../..
```

---

## ğŸ› å…¶ä»–å¯èƒ½çš„é—®é¢˜

### é—®é¢˜ 1: æ„å»ºå¤±è´¥

**ç—‡çŠ¶**ï¼šActions æ—¥å¿—æ˜¾ç¤º `pnpm run build` å¤±è´¥

**è§£å†³**ï¼š
1. æœ¬åœ°æµ‹è¯•æ„å»ºï¼š
   ```bash
   cd mizuki
   pnpm install
   pnpm run build
   ```

2. å¦‚æœæœ¬åœ°ä¹Ÿå¤±è´¥ï¼ŒæŸ¥çœ‹é”™è¯¯ä¿¡æ¯
3. å¯èƒ½æ˜¯ä¾èµ–é—®é¢˜ï¼Œå°è¯•ï¼š
   ```bash
   rm -rf node_modules pnpm-lock.yaml
   pnpm install
   pnpm run build
   ```

### é—®é¢˜ 2: æƒé™é—®é¢˜

**ç—‡çŠ¶**ï¼šActions æ—¥å¿—æ˜¾ç¤º "Permission denied"

**è§£å†³**ï¼š
1. æ£€æŸ¥ DEPLOY_KEY æ˜¯å¦æœ‰å†™å…¥æƒé™
2. æ£€æŸ¥ Pages ä»“åº“çš„ Settings â†’ Actions â†’ General
3. ç¡®ä¿ "Workflow permissions" è®¾ç½®ä¸º "Read and write permissions"

### é—®é¢˜ 3: åˆ†æ”¯ä¸åŒ¹é…

**ç—‡çŠ¶**ï¼šæ¨é€æˆåŠŸä½†ç½‘ç«™æ²¡æ›´æ–°

**è§£å†³**ï¼š
1. æ£€æŸ¥ä½ æ¨é€çš„åˆ†æ”¯æ˜¯å¦æ˜¯ `master`
2. æ£€æŸ¥ Actions é…ç½®çš„è§¦å‘åˆ†æ”¯
3. æ£€æŸ¥ Pages ä»“åº“çš„éƒ¨ç½²åˆ†æ”¯è®¾ç½®

---

## ğŸ“ æ¨èçš„è§£å†³é¡ºåº

### æœ€ç®€å•çš„æ–¹æ³•ï¼ˆæ¨èï¼‰

1. **ä½¿ç”¨ deploy-fixed.yml**ï¼ˆä¸éœ€è¦é…ç½® DEPLOY_KEYï¼‰
   ```bash
   cd mizuki/.github/workflows
   ren deploy.yml deploy.yml.bak
   git add .
   git commit -m "Use simplified deployment"
   git push origin master
   ```

2. **é…ç½® Pages è®¾ç½®**
   - ä»“åº“ Settings â†’ Pages
   - Source: Deploy from a branch
   - Branch: `gh-pages`

3. **è®¿é—®ç½‘ç«™**
   - `https://ä½ çš„ç”¨æˆ·å.github.io/ä½ çš„ä»“åº“å/`

### å¦‚æœæƒ³ç”¨åŸæ¥çš„æ–¹å¼ï¼ˆéƒ¨ç½²åˆ° dandingbobaishi.github.ioï¼‰

1. **é…ç½® SSH å¯†é’¥**ï¼ˆæŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ï¼‰
2. **ä¿æŒåŸæ¥çš„ deploy.yml**
3. **æ¨é€ä»£ç **

---

## ğŸ¯ å¿«é€Ÿæµ‹è¯•

è¿è¡Œè¿™ä¸ªå‘½ä»¤æµ‹è¯•æœ¬åœ°æ„å»ºï¼š

```bash
cd mizuki
pnpm install
pnpm run build
```

å¦‚æœæˆåŠŸï¼Œä¼šåœ¨ `dist/` ç›®å½•ç”Ÿæˆé™æ€æ–‡ä»¶ã€‚

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œè¯·æä¾›ï¼š
1. GitHub Actions çš„å®Œæ•´é”™è¯¯æ—¥å¿—
2. æœ¬åœ° `pnpm run build` çš„è¾“å‡º
3. ä½ çš„ä»“åº“åœ°å€

æˆ‘ä¼šå¸®ä½ è¿›ä¸€æ­¥æ’æŸ¥ï¼
